{% extends "racesow/_base.html" %}{% load tags %}{% load humanize %}
{% block title %}{{ block.super }} - Players{% endblock title %}

{% block navigation-sub %}
    <div id="navigation-sub">{% url 'rs:pln' as pn %}{% url 'rs:plo' as po %}
        <ul>
            <li class="{% active_subpage request pn %}"><a href="{{ pn }}">Current version</a></li>
            <li class="{% active_subpage request po %}"><a href="{{ po }}">Old version (1.0)</a></li>
        </ul>
    </div>
{% endblock navigation-sub %}

{% block content %}{% spaceless %}
    <h1>Players</h1>

    {% if players %}<p>Displaying {{ players|length }}/{{ players.paginator.count }} players.</p>{% endif %}

    {% include 'racesow/elements/searchbox.html' %}

    {% if players %}
        {# Handle page stuff #}
        {% with results=players next_url=playerlist %}{% include "racesow/elements/pagination.html" %}{% endwith %}

        {# Print the version-specific playerlist #}
        <table id="players">
        {% if version == "old" %}
            {# Name Points- Skill Maps Races Playtime #}
            <tr class="tableheader">
                <td class="name">
                    {% format_header "name" order as h_name %}
                    <a href="{% url playerlist page=1 q=query order=h_name.url %}">{{ h_name.title }}</a></td>
                <td class="points">
                    {% format_header "points" order as h_points %}
                    <a href="{% url playerlist page=1 q=query order=h_points.url %}">{{ h_points.title }}</a></td>
                <td class="points">
                    {% format_header "skill" order as h_skill %}
                    <a href="{% url playerlist page=1 q=query order=h_skill.url %}">{{ h_skill.title }}</a></td>
                <td class="points">
                    {% format_header "maps" order as h_maps %}
                    <a href="{% url playerlist page=1 q=query order=h_maps.url %}">{{ h_maps.title }}</a></td>
                <td class="points">
                    {% format_header "races" order as h_races %}
                    <a href="{% url playerlist page=1 q=query order=h_races.url %}">{{ h_races.title }}</a></td>
                <td class="time">
                    {% format_header "playtime" order as h_playtime %}
                    <a href="{% url playerlist page=1 q=query order=h_playtime.url %}">{{ h_playtime.title }}</a></td>
            </tr>
            {% for player in players %}
                <tr>
                    <td class="name"><a href={% url 'rs:pdo' player.id %}>{{ player.htmlname|safe }}</a>
                    </td>
                    <td class="points">{{ player.points }}</td>
                    <td class="points">{{ player.skill|floatformat:2 }}</td>
                    <td class="points">{{ player.maps }}</td>
                    <td class="points">{{ player.races }}</td>
                    <td class="time">{{ player.playtime_formatted }}</td>
                </tr>
            {% endfor %}
        {% elif version == "new" %}
            {# Name Maps Races Playtime #}
            <tr class="tableheader">
                <td class="name">
                    {% format_header "name" order as h_name %}
                    <a href="{% url playerlist page=1 q=query order=h_name.url %}">{{ h_name.title }}</a>
                <td class="points">
                    {% format_header "points" order as h_points %}
                    <a href="{% url playerlist page=1 q=query order=h_points.url %}">{{ h_points.title }}</a></td>
                <td class="points">
                    {% format_header "skill" order as h_skill %}
                    <a href="{% url playerlist page=1 q=query order=h_skill.url %}">{{ h_skill.title }}</a></td>
                <td class="points">
                    {% format_header "maps" order as h_maps %}
                    <a href="{% url playerlist page=1 q=query order=h_maps.url %}">{{ h_maps.title }}</a></td>
                <td class="points">
                    {% format_header "races" order as h_races %}
                    <a href="{% url playerlist page=1 q=query order=h_races.url %}">{{ h_races.title }}</a></td>
                <td class="time">
                    {% format_header "playtime" order as h_playtime %}
                    <a href="{% url playerlist page=1 q=query order=h_playtime.url %}">{{ h_playtime.title }}</a></td>
            </tr>
            {% for player in players %}
                <tr>
                    <td class="name"><a href={% url 'rs:pdn' player.id %}>{{ player.htmlname|safe }}</a></td>
                    <td class="points">{{ player.get_points|floatformat:0 }}</td>
                    <td class="points">{{ player.skill|floatformat:2 }}</td>
                    <td class="points">{{ player.maps }}</td>
                    <td class="points">{{ player.races }}</td>
                    <td class="time">{{ player.playtime_formatted }}</td>
                </tr>
            {% endfor %}
        {% else %}
            <p>Error: unexpected version '{{ version }}'</p>
        {% endif %}
        </table>
    {% else %}
        <p>No players found for version '{{ version }}'.</p>
    {% endif %}
{% endspaceless %}{% endblock content %}

{% if debug and notice %}
    {% block notice %}{{ notice }}{% endblock notice %}
{% endif %}